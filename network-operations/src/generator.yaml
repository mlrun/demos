kind: remote
metadata:
  name: nuclio-generator
  tag: ''
  hash: eb70efde7419915820f5e88d0134fe9737c80281
  project: ''
spec:
  command: ''
  args: []
  image: ''
  description: ''
  min_replicas: 1
  max_replicas: 4
  env:
  - name: V3IO_API
    value: ''
  - name: V3IO_USERNAME
    value: ''
  - name: V3IO_ACCESS_KEY
    value: ''
  config:
    spec.triggers.cron:
      kind: cron
      attributes:
        interval: 1m
  base_spec:
    apiVersion: nuclio.io/v1
    kind: Function
    metadata:
      annotations:
        nuclio.io/generated_by: function generated from 08-07-2020 by admin
      labels: {}
      name: nuclio-generator
    spec:
      build:
        commands:
        - pip install pyarrow
        - pip install pandas
        - pip install pytimeparse
        - pip install v3io_frames --upgrade
        - pip install -i https://test.pypi.org/simple/ v3io-generator
        - pip install faker
        functionSourceCode: IyBHZW5lcmF0ZWQgYnkgbnVjbGlvLmV4cG9ydC5OdWNsaW9FeHBvcnRlcgoKaW1wb3J0IG9zCmltcG9ydCB0aW1lCmltcG9ydCB5YW1sCmltcG9ydCBwYW5kYXMgYXMgcGQKaW1wb3J0IGl0ZXJ0b29scwppbXBvcnQgZGF0ZXRpbWUKCmltcG9ydCB2M2lvX2ZyYW1lcyBhcyB2M2YKCmZyb20gdjNpb19nZW5lcmF0b3IgaW1wb3J0IG1ldHJpY3NfZ2VuZXJhdG9yLCBkZXBsb3ltZW50X2dlbmVyYXRvcgoKZGVmIF9jcmVhdGVfZGVwbG95bWVudCgpOgogICAgcHJpbnQoJ2NyZWF0aW5nIGRlcGxveW1lbnQnKQogICAgZGVwX2dlbiA9IGRlcGxveW1lbnRfZ2VuZXJhdG9yLmRlcGxveW1lbnRfZ2VuZXJhdG9yKCkKICAgIGZha2VyPWRlcF9nZW4uZ2V0X2Zha2VyKCkKCiAgICBkZXBfZ2VuLmFkZF9sZXZlbChuYW1lPSdjb21wYW55JyxudW1iZXI9MixsZXZlbF90eXBlPWZha2VyLmNvbXBhbnkpCiAgICBkZXBfZ2VuLmFkZF9sZXZlbCgnZGF0YV9jZW50ZXInLG51bWJlcj0yLGxldmVsX3R5cGU9ZmFrZXIuc3RyZWV0X25hbWUpCiAgICBkZXBfZ2VuLmFkZF9sZXZlbCgnZGV2aWNlJyxudW1iZXI9MixsZXZlbF90eXBlPWZha2VyLm1zaXNkbikKCiAgICBkZXBsb3ltZW50X2RmID0gZGVwX2dlbi5nZW5lcmF0ZV9kZXBsb3ltZW50KCkKICAgIHJldHVybiBkZXBsb3ltZW50X2RmCgpkZWYgX2lzX2RlcGxveW1lbnRfZXhpc3QocGF0aCk6CiAgICByZXR1cm4gb3MucGF0aC5leGlzdHMoZicvdjNpby9iaWdkYXRhL3twYXRofScpCgpkZWYgX2dldF9kZXBsb3ltZW50X2Zyb21fa3YoY2xpZW50LCBwYXRoKToKICAgIHByaW50KGYnUmV0cmlldmluZyBkZXBsb3ltZW50IGZyb20ge3BhdGh9JykKICAgIGNvbnRleHQubG9nZ2VyLmRlYnVnKGYnUmV0cmlldmluZyBkZXBsb3ltZW50IGZyb20ge3BhdGh9JykKICAgIGRlcGxveW1lbnRfZGYgPSBjbGllbnQucmVhZChiYWNrZW5kPSdrdicsIHRhYmxlPXBhdGgpCiAgICAKICAgIGRlcGxveW1lbnRfZGYuaW5kZXgubmFtZSA9ICdkZXZpY2UnCiAgICBkZXBsb3ltZW50X2RmID0gZGVwbG95bWVudF9kZi5yZXNldF9pbmRleCgpCiAgICByZXR1cm4gZGVwbG95bWVudF9kZgoKZGVmIF9zYXZlX2RlcGxveW1lbnRfdG9fa3YocGF0aCwgZGYsIGNsaWVudD12M2YuQ2xpZW50KCdmcmFtZXNkOjgwODEnKSk6CiAgICBjbGllbnQud3JpdGUoYmFja2VuZD0na3YnLCB0YWJsZT0nbmV0b3BzX2RldmljZXMnLGRmcz1kZiwgaW5kZXhfY29scz1bJ2RldmljZSddKQoKZGVmIGdldF9vcl9jcmVhdGVfZGVwbG95bWVudChwYXRoLCBzYXZlX3RvX2Nsb3VkPUZhbHNlLCBjbGllbnQ9Tm9uZSk6CiAgICBpZiBjbGllbnQgYW5kIF9pc19kZXBsb3ltZW50X2V4aXN0KHBhdGgpOgogICAgICAgIGRlcGxveW1lbnRfZGYgPSBfZ2V0X2RlcGxveW1lbnRfZnJvbV9rdihjbGllbnQsIHBhdGgpCiAgICBlbHNlOgogICAgICAgIGRlcGxveW1lbnRfZGYgPSBfY3JlYXRlX2RlcGxveW1lbnQoKQogICAgICAgIAogICAgICAgIGlmIGNsaWVudCBhbmQgc2F2ZV90b19jbG91ZDoKICAgICAgICAgICAgX3NhdmVfZGVwbG95bWVudF90b19rdihwYXRoLCBkZXBsb3ltZW50X2RmLCBjbGllbnQpCgogICAgcmV0dXJuIGRlcGxveW1lbnRfZGYKCmRlZiBzZXRfaW5kZXhlcyhkZik6CiAgICBkZiA9IGRmLnNldF9pbmRleChbJ3RpbWVzdGFtcCcsICdjb21wYW55JywgJ2RhdGFfY2VudGVyJywgJ2RldmljZSddKQogICAgcmV0dXJuIGRmCgpkZWYgc2F2ZV9tZXRyaWNzX3RvX3RzZGIoY29udGV4dCwgbWV0cmljczogcGQuRGF0YUZyYW1lKToKICAgIHByaW50KCdTYXZpbmcgbWV0cmljcyB0byBUU0RCJykKICAgIAogICAgY29udGV4dC52M2Yud3JpdGUoJ3RzZGInLCBjb250ZXh0Lm1ldHJpY3NfdGFibGUsIG1ldHJpY3MpCgpkZWYgc2F2ZV9tZXRyaWNzX3RvX3BhcnF1ZXQoY29udGV4dCwgbWV0cmljcyk6CiAgICBwcmludCgnU2F2aW5nIG1ldHJpY3MgdG8gUGFycXVldCcpCiAgICBkZiA9IHBkLmNvbmNhdChpdGVydG9vbHMuY2hhaW4obWV0cmljcykpCiAgICAKICAgIGRmID0gZGYucmVzZXRfaW5kZXgoKQogICAgZGZbJ3RpbWVzdGFtcCddID0gZGYubG9jWzosICd0aW1lc3RhbXAnXS5hc3R5cGUoJ2RhdGV0aW1lNjRbbXNdJykKICAgIAogICAgZGYgPSBzZXRfaW5kZXhlcyhkZikKICAgIAogICAgZmlyc3RfdGltZXN0YW1wID0gZGYuaW5kZXhbMF1bMF0uc3RyZnRpbWUoJyVZJW0lZFQlSCVNJVMnKQogICAgbGFzdF90aW1lc3RhbXAgPSBkZi5pbmRleFstMV1bMF0uc3RyZnRpbWUoJyVZJW0lZFQlSCVNJVMnKQogICAgZmlsZW5hbWUgPSBmaXJzdF90aW1lc3RhbXAgKyAnLScgKyBsYXN0X3RpbWVzdGFtcCArICcucGFycXVldCcKICAgIHByaW50KGZpbGVuYW1lKQogICAgZmlsZXBhdGggPSBvcy5wYXRoLmpvaW4oY29udGV4dC5tZXRyaWNzX3RhYmxlLCBmaWxlbmFtZSkKICAgIHByaW50KGZpbGVwYXRoKQogICAgd2l0aCBvcGVuKGZpbGVwYXRoLCAnd2IrJykgYXMgZjoKICAgICAgICBkZi50b19wYXJxdWV0KGYpCgpkZWYgaXNfZGVwbG95bWVudF9pbml0aWFsaXplZChjb250ZXh0KToKICAgIHJldHVybiBoYXNhdHRyKGNvbnRleHQsICdtZXRyaWNfZ2VuZXJhdG9yJykKCmRlZiBpbml0X2NvbnRleHQoY29udGV4dCk6CiAgICAKICAgIHNhdmVfdG9fdHNkYiA9IChpbnQob3MuZ2V0ZW52KCdTQVZFX1RPX1RTREInLCAxKSkgPT0gMSkKICAgIAogICAgbWV0cmljc190YWJsZSA9IG9zLmdldGVudignU0FWRV9UTycsICduZXRvcHNfbWV0cmljcycpCiAgICBzZXRhdHRyKGNvbnRleHQsICdtZXRyaWNzX3RhYmxlJywgbWV0cmljc190YWJsZSkgCgogICAgaWYgc2F2ZV90b190c2RiOgogICAgICAgIGNvbnRleHQubG9nZ2VyLmRlYnVnKCdTYXZpbmcgdG8gVFNEQicpCiAgICAgICAgY2xpZW50ID0gdjNmLkNsaWVudChhZGRyZXNzPSdmcmFtZXNkOjgwODEnLCBjb250YWluZXI9J2JpZ2RhdGEnKQogICAgICAgIAogICAgICAgIGNsaWVudC5jcmVhdGUoJ3RzZGInLCBtZXRyaWNzX3RhYmxlLCByYXRlPScxL3MnLCBpZl9leGlzdHM9MSkKICAgICAgICAKICAgICAgICBzZXRhdHRyKGNvbnRleHQsICd3cml0ZScsIHNhdmVfbWV0cmljc190b190c2RiKQogICAgCiAgICBlbHNlOgogICAgICAgIGNvbnRleHQubG9nZ2VyLmRlYnVnKCdTYXZpbmcgdG8gUGFycXVldCcpCiAgICAgICAgY2xpZW50ID0gTm9uZQogICAgICAgICAgCiAgICAgICAgZmlsZXBhdGggPSBvcy5wYXRoLmpvaW4obWV0cmljc190YWJsZSkKICAgICAgICBpZiBub3Qgb3MucGF0aC5leGlzdHMoZmlsZXBhdGgpOgogICAgICAgICAgICBvcy5tYWtlZGlycyhmaWxlcGF0aCkKICAgICAgICAKICAgICAgICBzZXRhdHRyKGNvbnRleHQsICd3cml0ZScsIHNhdmVfbWV0cmljc190b19wYXJxdWV0KQogICAgCiAgICAgICAgICAKICAgIHNlY3NfdG9fZ2VuZXJhdGUgPSBvcy5nZXRlbnYoJ1NFQ1NfVE9fR0VORVJBVEUnLCAxMCkKICAgIHNldGF0dHIoY29udGV4dCwgJ3NlY3NfdG9fZ2VuZXJhdGUnLCBzZWNzX3RvX2dlbmVyYXRlKQogICAgCiAgICAgCiAgICAKICAgIGRlcGxveW1lbnRfZGYgPSBnZXRfb3JfY3JlYXRlX2RlcGxveW1lbnQob3MuZW52aXJvblsnREVQTE9ZTUVOVF9UQUJMRSddLCBvcy5lbnZpcm9uWydTQVZFX0RFUExPWU1FTlQnXSwgY2xpZW50KQogICAgCiAgICBkZXBsb3ltZW50X2RmWydjcHVfdXRpbGl6YXRpb24nXSA9IDcwCiAgICBkZXBsb3ltZW50X2RmWydsYXRlbmN5J10gPSAwCiAgICBkZXBsb3ltZW50X2RmWydwYWNrZXRfbG9zcyddID0gMAogICAgZGVwbG95bWVudF9kZlsndGhyb3VnaHB1dCddID0gMjkwCiAgICBkZXBsb3ltZW50X2RmLmhlYWQoKQogICAgCiAgICB3aXRoIG9wZW4ob3MuZ2V0ZW52KCdNRVRSSUNTX0NPTkZJR1VSQVRJT05fRklMRVBBVEgnLCAnL2NvbmZpZ3VyYXRpb25zL21ldHJpY3NfY29uZmlndXJhdGlvbi55YW1sJyksICdyJykgYXMgZjoKICAgICAgICBtZXRyaWNzX2NvbmZpZ3VyYXRpb24gPSB5YW1sLmxvYWQoZikKICAgICAgICAKICAgIGluaXRpYWxfdGltZXN0YW1wID0gaW50KG9zLmdldGVudignaW5pdGlhbF90aW1lc3RhbXAnLCAoZGF0ZXRpbWUuZGF0ZXRpbWUubm93KCktZGF0ZXRpbWUudGltZWRlbHRhKGRheXM9MSkpLnRpbWVzdGFtcCgpKSkKICAgIG1ldF9nZW4gPSBtZXRyaWNzX2dlbmVyYXRvci5HZW5lcmF0b3JfZGYobWV0cmljc19jb25maWd1cmF0aW9uLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXNlcl9oaWVyYXJjaHk9ZGVwbG95bWVudF9kZiwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluaXRpYWxfdGltZXN0YW1wPWluaXRpYWxfdGltZXN0YW1wKQogICAgc2V0YXR0cihjb250ZXh0LCAnbWV0cmljX2dlbmVyYXRvcicsIG1ldF9nZW4pCiAgICAKICAgIHNldGF0dHIoY29udGV4dCwgJ3YzZicsIGNsaWVudCkKCmRlZiBoYW5kbGVyKGNvbnRleHQsIGV2ZW50KToKICAgICAgIAogICAgbWV0cmljcyA9IGNvbnRleHQubWV0cmljX2dlbmVyYXRvci5nZW5lcmF0ZV9yYW5nZShzdGFydF90aW1lPWRhdGV0aW1lLmRhdGV0aW1lLm5vdygpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kX3RpbWU9ZGF0ZXRpbWUuZGF0ZXRpbWUubm93KCkrZGF0ZXRpbWUudGltZWRlbHRhKHNlY29uZHM9aW50KGNvbnRleHQuc2Vjc190b19nZW5lcmF0ZSkpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXNfZGY9VHJ1ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFzX2l0ZXJhdG9yPVRydWUpCiAgICAKICAgIGNvbnRleHQud3JpdGUoY29udGV4dCwgbWV0cmljcykKCg==
        noBaseImagesPull: true
        baseImage: mlrun/ml-models:unstable
      env:
      - name: SAVE_DEPLOYMENT
        value: '1'
      - name: DEPLOYMENT_TABLE
        value: devices
      - name: METRICS_CONFIGURATION_FILEPATH
        value: /User/demos/network-operations/src/metric_configurations.yaml
      - name: SAVE_TO
        value: /User/demos/network-operations/streaming/metrics
      - name: SECS_TO_GENERATE
        value: '3600'
      - name: SAVE_TO_TSDB
        value: '0'
      handler: generator:handler
      runtime: python:3.6
      volumes: []
  source: ''
